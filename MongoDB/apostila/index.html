<!doctype html>
<html lang="en">

<head>
        <title>Apostila - Meus Estudos</title>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        
        
        

        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
            <link rel="stylesheet" href="../../assets/css/darcula-highlight.min.css">

        <link rel="stylesheet" href="../../assets/css/bootstrap.min.css">
        <link rel="stylesheet" href="../../assets/css/dracula-ui.min.css">
        <link rel="stylesheet" href="../../assets/css/mkdocs.min.css">

        
            <link  rel="icon" type="image/x-icon" href="../../assets/img/favicon.ico">
        
            <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
                <script>hljs.initHighlightingOnLoad();</script>

</head>

<body class="drac-bg-black-secondary drac-text-grey-ternary drac-text drac-scrollbar-purple">

    <main class="d-flex">

        <!-- block sidebar -->
            <nav id="sidebar" class="sidebar drac-bg-black">
    <div class="custom-menu">
        <button type="button" id="sidebarCollapse" class="btn btn-primary">
            <i class="fa fa-bars"></i>
            <span class="sr-only">Menu</span>
        </button>
    </div>

    <div class="p-4">
        

        <div class="drac-text-center">
            
                <span class="drac-text drac-line-height drac-text-white">Meus Estudos</span>
            
        </div>

        <div class="drac-box flex-column">
            <ul class="dot-ul">
                <li><div class="dot-li drac-bg-cyan"></div></li>
                <li><div class="dot-li drac-bg-green"></div></li>
                <li><div class="dot-li drac-bg-orange"></div></li>
                <li><div class="dot-li drac-bg-pink"></div></li>
                <li><div class="dot-li drac-bg-purple"></div></li>
                <li><div class="dot-li drac-bg-red"></div></li>
                <li><div class="dot-li drac-bg-yellow"></div></li>
            </ul>
        </div>

        <hr class="drac-divider" />

        <!-- block menu -->
        <ul class="mb-5 drac-list drac-list-none">
            
            <li class="drac-box">
                <a href="../.."
                    class="
                    drac-anchor d-inline-flex align-items-center border-0 drac-text-purple--hover">
                    Início
                </a>
            </li>
            <li class="drac-box">
                <a href="../.."
                    class="
                    drac-anchor btn-toggle d-inline-flex align-items-center border-0 drac-text-purple--hover collapsed"
                    data-bs-toggle="collapse" data-bs-target="#requisitos-collapse" aria-expanded="false">
                    Requisitos
                </a>
                <div class="collapse" id="requisitos-collapse">
                    <ul class="mb-5 drac-list drac-list-none">
                            
    <li class="drac-box-ternary">
        <a href="../../Requisitos/"
            class="
            drac-anchor d-inline-flex align-items-center border-0 drac-text-purple--hover">
            Visão Geral
        </a>
    </li>
                    </ul>
                </div>
            </li>
            <li class="drac-box">
                <a href="../.."
                    class="
                    drac-anchor btn-toggle d-inline-flex align-items-center border-0 drac-text-purple--hover collapsed"
                    data-bs-toggle="collapse" data-bs-target="#lógica-collapse" aria-expanded="false">
                    Lógica
                </a>
                <div class="collapse" id="lógica-collapse">
                    <ul class="mb-5 drac-list drac-list-none">
                            
    <li class="drac-box-ternary">
        <a href="../../Logica/apostila/"
            class="
            drac-anchor d-inline-flex align-items-center border-0 drac-text-purple--hover">
            Lógica de Programação
        </a>
    </li>
                    </ul>
                </div>
            </li>
            <li class="drac-box">
                <a href="../.."
                    class="
                    drac-anchor btn-toggle d-inline-flex align-items-center border-0 drac-text-purple--hover collapsed"
                    data-bs-toggle="collapse" data-bs-target="#web-collapse" aria-expanded="false">
                    Web
                </a>
                <div class="collapse" id="web-collapse">
                    <ul class="mb-5 drac-list drac-list-none">
                            
    <li class="drac-box-ternary">
        <a href="../../Web/Armazenamento/"
            class="
            drac-anchor d-inline-flex align-items-center border-0 drac-text-purple--hover">
            Armazenamento Web
        </a>
    </li>
                    </ul>
                </div>
            </li>
            <li class="drac-box">
                <a href="../.."
                    class="
                    drac-anchor btn-toggle d-inline-flex align-items-center border-0 drac-text-purple--hover collapsed"
                    data-bs-toggle="collapse" data-bs-target="#typescript-collapse" aria-expanded="false">
                    TypeScript
                </a>
                <div class="collapse" id="typescript-collapse">
                    <ul class="mb-5 drac-list drac-list-none">
                            
    <li class="drac-box-ternary">
        <a href="../../Ts/estrutura-plano/"
            class="
            drac-anchor d-inline-flex align-items-center border-0 drac-text-purple--hover">
            Visão Geral
        </a>
    </li>
                            
    <li class="drac-box-ternary">
        <a href="../../Ts/Semana1/"
            class="
            drac-anchor d-inline-flex align-items-center border-0 drac-text-purple--hover">
            Semana 1
        </a>
    </li>
                            
    <li class="drac-box-ternary">
        <a href="../../Ts/Semana2/"
            class="
            drac-anchor d-inline-flex align-items-center border-0 drac-text-purple--hover">
            Semana 2
        </a>
    </li>
                            
    <li class="drac-box-ternary">
        <a href="../../Ts/Semana3/"
            class="
            drac-anchor d-inline-flex align-items-center border-0 drac-text-purple--hover">
            Semana 3
        </a>
    </li>
                            
    <li class="drac-box-ternary">
        <a href="../../Ts/Semana4/"
            class="
            drac-anchor d-inline-flex align-items-center border-0 drac-text-purple--hover">
            Semana 4
        </a>
    </li>
                    </ul>
                </div>
            </li>
            <li class="drac-box">
                <a href="../.."
                    class=" active 
                    drac-anchor btn-toggle d-inline-flex align-items-center border-0 drac-text-purple--hover collapsed"
                    data-bs-toggle="collapse" data-bs-target="#mongo-collapse" aria-expanded="false">
                    Mongo
                </a>
                <div class="collapse" id="mongo-collapse">
                    <ul class="mb-5 drac-list drac-list-none">
                            
    <li class="drac-box-ternary">
        <a href="./"
            class=" active 
            drac-anchor d-inline-flex align-items-center border-0 drac-text-purple--hover">
            Apostila
        </a>
    </li>
                            
    <li class="drac-box-ternary">
        <a href="../respostas/"
            class="
            drac-anchor d-inline-flex align-items-center border-0 drac-text-purple--hover">
            Respostas
        </a>
    </li>
                            
    <li class="drac-box-ternary">
        <a href="../tarefas/"
            class="
            drac-anchor d-inline-flex align-items-center border-0 drac-text-purple--hover">
            Tarefas
        </a>
    </li>
                    </ul>
                </div>
            </li>
        </ul>
        <!-- endblock -->
    </div>
</nav>
        <!-- endblock -->

        <nav class="divider drac-bg-purple-cyan"></nav>

        <div class="content">
            <!-- block header -->
                <header>
    <nav class="navbar navbar-expand-xl drac-bg-purple">
        <div class="container-fluid">
            
            <button class="navbar-toggler w-100 text-center" type="button" data-bs-toggle="collapse" data-bs-target="#navbarsMenu"
                aria-controls="navbarsMenu" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse flex-column ml-auto" id="navbarsMenu">
                <ul class="navbar-nav text-md-center">

                    <!-- block preview -->
                    <li class="nav-item">
                            
        <div class="container">
            <div class="row row-preview">
                <div class="col">
                    <a href="../../Ts/Semana4/"
                        class="btn-preview drac-btn drac-btn-outline drac-text-white drac-text-cyan-green--hover">
                        <i class="fa fa-arrow-left"></i> Previous
                    </a>
                </div>
                <div class="col">
                    <a href="../respostas/"
                        class="btn-preview drac-btn drac-btn-outline drac-text-white drac-text-cyan-green--hover" style="padding-left: 3%;">
                        Next <i class="fa fa-arrow-right"></i>
                    </a>
                </div>
            </div>
        </div>
                    </li>
                    <!--  endblock -->

                    <!-- block search -->
                    <li class="nav-item"><div role="search" class="search-box">
	<form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
		<input type="text" name="q" class="drac-input drac-input-search drac-input-white drac-text-white drac-bg-black-secondary"
		placeholder="Search docs" title="Type search term here" />
	</form>
</div>
                    </li>
                    <!--  endblock -->

                    <!-- block source -->
                    <li class="nav-item">
                        
                    </li>
                    <!--  endblock -->

                </ul>
            </div>

        </div>
    </nav>
</header>
            <!-- endblock -->

            <!-- block content -->
                <section class="p-md-5 section-content">
    <article>
        <p><h1 id="workshop-mongodb-do-basico-ao-avancado">Workshop MongoDB: Do Básico ao Avançado</h1>
<h2 id="plano-de-aula">Plano de Aula</h2>
<h3 id="curva-de-aprendizado">Curva de Aprendizado</h3>
<ol>
<li><strong>Fundamentos de NoSQL</strong> - Entendendo bancos não relacionais</li>
<li><strong>Instalação e Configuração</strong> - Ambiente de desenvolvimento</li>
<li><strong>CRUD Básico</strong> - Operações fundamentais</li>
<li><strong>Consultas Avançadas</strong> - Busca e filtragem de dados</li>
<li><strong>Índices e Performance</strong> - Otimização de consultas</li>
<li><strong>Modelagem de Dados</strong> - Estruturas e relacionamentos</li>
<li><strong>Agregações</strong> - Processamento de dados complexos</li>
<li><strong>Operações Avançadas</strong> - Backup, exportação e migração</li>
<li><strong>MongoDB em Ambientes Reais</strong> - Docker e cenários de produção</li>
</ol>
<h3 id="dataset-para-o-workshop">Dataset para o Workshop</h3>
<p>Vamos trabalhar com um dataset de uma loja online que inclui:</p>
<ul>
<li>Produtos</li>
<li>Clientes</li>
<li>Pedidos</li>
<li>Avaliações</li>
</ul>
<hr />
<h2 id="modulo-1-fundamentos-de-bancos-de-dados-nosql">Módulo 1: Fundamentos de Bancos de Dados NoSQL</h2>
<h3 id="o-que-sao-bancos-de-dados-nosql">O que são Bancos de Dados NoSQL?</h3>
<p>NoSQL (Not Only SQL) refere-se a bancos de dados não relacionais projetados para armazenar, distribuir e acessar dados usando modelos diferentes do tradicional modelo relacional.</p>
<h3 id="tipos-de-bancos-nosql">Tipos de Bancos NoSQL</h3>
<ol>
<li><strong>Documentos</strong> (MongoDB, CouchDB)</li>
<li><strong>Chave-valor</strong> (Redis, DynamoDB)</li>
<li><strong>Colunar</strong> (Cassandra, HBase)</li>
<li><strong>Grafos</strong> (Neo4j, JanusGraph)</li>
</ol>
<h3 id="comparacao-relacional-vs-nosql">Comparação: Relacional vs NoSQL</h3>
<table>
<thead>
<tr>
<th style="text-align: left;"><strong>Característica</strong></th>
<th style="text-align: left;"><strong>Relacional (SQL)</strong></th>
<th style="text-align: left;"><strong>NoSQL (MongoDB)</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">Estrutura</td>
<td style="text-align: left;">Tabelas, linhas e colunas</td>
<td style="text-align: left;">Coleções e documentos</td>
</tr>
<tr>
<td style="text-align: left;">Schema</td>
<td style="text-align: left;">Rígido</td>
<td style="text-align: left;">Flexível/Dinâmico</td>
</tr>
<tr>
<td style="text-align: left;">Relacionamentos</td>
<td style="text-align: left;">Joins</td>
<td style="text-align: left;">Documentos aninhados/Referências</td>
</tr>
<tr>
<td style="text-align: left;">Escalabilidade</td>
<td style="text-align: left;">Vertical</td>
<td style="text-align: left;">Horizontal</td>
</tr>
<tr>
<td style="text-align: left;">Consistência</td>
<td style="text-align: left;">ACID</td>
<td style="text-align: left;">Eventual (BASE)</td>
</tr>
<tr>
<td style="text-align: left;">Casos de uso</td>
<td style="text-align: left;">Dados estruturados, transações</td>
<td style="text-align: left;">Grandes volumes, dados variáveis</td>
</tr>
</tbody>
</table>
<h3 id="casos-de-uso-reais-para-mongodb">Casos de Uso Reais para MongoDB</h3>
<ol>
<li><strong>Aplicações de Conteúdo</strong>: CMS, blogs, redes sociais</li>
<li><strong>E-commerce</strong>: Catálogos de produtos, perfis de usuários</li>
<li><strong>IoT</strong>: Armazenamento de dados de sensores</li>
<li><strong>Aplicações Mobile</strong>: Backend para apps</li>
<li><strong>Analytics em Tempo Real</strong>: Painéis, métricas</li>
<li><strong>Gerenciamento de Catálogos</strong>: Produtos com atributos variáveis</li>
</ol>
<hr />
<h2 id="modulo-2-instalacao-e-configuracao-do-mongodb">Módulo 2: Instalação e Configuração do MongoDB</h2>
<h3 id="instalacao-convencional">Instalação Convencional</h3>
<ul>
<li>Para Ubuntu/Debian</li>
</ul>
<pre><code class="language-bash">sudo apt-get update
sudo apt-get install -y mongodb-org
</code></pre>
<ul>
<li>Para MacOS (com Homebrew)</li>
</ul>
<pre><code class="language-bash">brew tap mongodb/brew
brew install mongodb-community
</code></pre>
<ul>
<li>Para Windows</li>
<li>Baixe o instalador em mongodb.com/try/download/community</li>
</ul>
<h3 id="instalacao-via-docker">Instalação via Docker</h3>
<ul>
<li>Puxar a imagem oficial do MongoDB</li>
</ul>
<pre><code class="language-bash">docker pull mongo
</code></pre>
<ul>
<li>Executar o container MongoDB</li>
</ul>
<pre><code class="language-bash">docker run --name mongodb -p 27017:27017 -d mongo
</code></pre>
<ul>
<li>Executar com persistência de dados</li>
</ul>
<pre><code class="language-bash">docker run --name mongodb -p 27017:27017 -v /caminho/local:/data/db -d mongo
</code></pre>
<h3 id="comparacao-entre-instalacoes">Comparação entre instalações</h3>
<table>
<thead>
<tr>
<th style="text-align: left;"><strong>Aspecto</strong></th>
<th style="text-align: left;"><strong>Instalação Convencional</strong></th>
<th style="text-align: left;"><strong>Docker</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">Facilidade</td>
<td style="text-align: left;">Média</td>
<td style="text-align: left;">Alta</td>
</tr>
<tr>
<td style="text-align: left;">Configuração</td>
<td style="text-align: left;">Manual</td>
<td style="text-align: left;">Simplificada</td>
</tr>
<tr>
<td style="text-align: left;">Isolamento</td>
<td style="text-align: left;">Não</td>
<td style="text-align: left;">Sim</td>
</tr>
<tr>
<td style="text-align: left;">Escalabilidade</td>
<td style="text-align: left;">Manual</td>
<td style="text-align: left;">Facilitada</td>
</tr>
<tr>
<td style="text-align: left;">Portabilidade</td>
<td style="text-align: left;">Baixa</td>
<td style="text-align: left;">Alta</td>
</tr>
<tr>
<td style="text-align: left;">Recursos</td>
<td style="text-align: left;">Usa recursos do host diretamente</td>
<td style="text-align: left;">Containerizado</td>
</tr>
</tbody>
</table>
<h3 id="conexao-ao-mongodb">Conexão ao MongoDB</h3>
<ul>
<li>Conexão local</li>
</ul>
<pre><code class="language-bash">mongo
</code></pre>
<ul>
<li>ou</li>
</ul>
<pre><code class="language-bash">mongosh
</code></pre>
<ul>
<li>Conexão com autenticação</li>
</ul>
<pre><code class="language-bash">mongo -u usuario -p senha --authenticationDatabase admin
</code></pre>
<ul>
<li>Conexão via string de conexão</li>
</ul>
<pre><code class="language-bash">mongo &quot;mongodb://usuario:senha@localhost:27017/database&quot;
</code></pre>
<h3 id="verificacao-da-instalacao">Verificação da instalação</h3>
<pre><code class="language-javascript">// Mostra os bancos existentes
show dbs

// Usa (ou cria) um banco específico
use ecommerce

// Mostra coleções no banco atual
show collections
</code></pre>
<hr />
<h2 id="modulo-3-crud-basico">Módulo 3: CRUD Básico</h2>
<h3 id="criacao-create">Criação (Create)</h3>
<pre><code class="language-javascript">// Inserir um único documento
db.produtos.insertOne({
  nome: &quot;Tablet Pro X&quot;,
  preco: 799.99,
  estoque: 25,
  categoria: &quot;Eletrônicos&quot;
})

// Inserir múltiplos documentos
db.produtos.insertMany([
  {
    nome: &quot;Mouse sem fio&quot;,
    preco: 49.99,
    estoque: 100,
    categoria: &quot;Acessórios&quot;
  },
  {
    nome: &quot;Teclado mecânico&quot;,
    preco: 129.99,
    estoque: 50,
    categoria: &quot;Acessórios&quot;
  }
])
</code></pre>
<h3 id="leitura-read">Leitura (Read)</h3>
<pre><code class="language-javascript">// Buscar todos os documentos
db.produtos.find()

// Buscar com formatação melhorada
db.produtos.find().pretty()

// Buscar com critérios
db.produtos.find({ categoria: &quot;Eletrônicos&quot; })

// Buscar um documento específico
db.produtos.findOne({ nome: &quot;Tablet Pro X&quot; })

// Buscar por ID
db.produtos.findOne({ _id: ObjectId(&quot;5f8d0d55b54764429c1e1111&quot;) })

// Limitar resultados
db.produtos.find().limit(3)

// Pular resultados (paginação)
db.produtos.find().skip(10).limit(10)
</code></pre>
<h3 id="atualizacao-update">Atualização (Update)</h3>
<pre><code class="language-javascript">// Atualizar um documento
db.produtos.updateOne(
  { nome: &quot;Tablet Pro X&quot; },
  { $set: { preco: 849.99, desconto: true } }
)

// Atualizar múltiplos documentos
db.produtos.updateMany(
  { categoria: &quot;Acessórios&quot; },
  { $inc: { estoque: -5 } }
)

// Substituir completamente um documento
db.produtos.replaceOne(
  { nome: &quot;Mouse sem fio&quot; },
  {
    nome: &quot;Mouse Bluetooth Premium&quot;,
    preco: 79.99,
    estoque: 30,
    categoria: &quot;Acessórios&quot;
  }
)
</code></pre>
<h3 id="remocao-delete">Remoção (Delete)</h3>
<pre><code class="language-javascript">// Remover um documento
db.produtos.deleteOne({ nome: &quot;Tablet Pro X&quot; })

// Remover múltiplos documentos
db.produtos.deleteMany({ estoque: { $lt: 10 } })

// Remover todos os documentos
db.produtos.deleteMany({})

// Remover uma coleção inteira
db.produtos.drop()
</code></pre>
<hr />
<h2 id="modulo-4-consultas-avancadas">Módulo 4: Consultas Avançadas</h2>
<h3 id="operadores-de-consulta">Operadores de Consulta</h3>
<table>
<thead>
<tr>
<th style="text-align: left;"><strong>Operador</strong></th>
<th style="text-align: left;"><strong>Explicação</strong></th>
<th style="text-align: left;"><strong>Exemplo</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><code>$eq</code></td>
<td style="text-align: left;">Corresponde a valores iguais ao especificado</td>
<td style="text-align: left;"><code>db.produtos.find({ preco: { $eq: 299.99 } })</code></td>
</tr>
<tr>
<td style="text-align: left;"><code>$ne</code></td>
<td style="text-align: left;">Corresponde a valores diferentes do especificado</td>
<td style="text-align: left;"><code>db.produtos.find({ categoria: { $ne: "Eletrônicos" } })</code></td>
</tr>
<tr>
<td style="text-align: left;"><code>$gt</code></td>
<td style="text-align: left;">Maior que o valor especificado</td>
<td style="text-align: left;"><code>db.produtos.find({ preco: { $gt: 1000 } })</code></td>
</tr>
<tr>
<td style="text-align: left;"><code>$gte</code></td>
<td style="text-align: left;">Maior ou igual ao valor especificado</td>
<td style="text-align: left;"><code>db.produtos.find({ estoque: { $gte: 20 } })</code></td>
</tr>
<tr>
<td style="text-align: left;"><code>$lt</code></td>
<td style="text-align: left;">Menor que o valor especificado</td>
<td style="text-align: left;"><code>db.produtos.find({ preco: { $lt: 500 } })</code></td>
</tr>
<tr>
<td style="text-align: left;"><code>$lte</code></td>
<td style="text-align: left;">Menor ou igual ao valor especificado</td>
<td style="text-align: left;"><code>db.produtos.find({ estoque: { $lte: 15 } })</code></td>
</tr>
<tr>
<td style="text-align: left;"><code>$in</code></td>
<td style="text-align: left;">Corresponde a qualquer valor do array especificado</td>
<td style="text-align: left;"><code>db.produtos.find({ categoria: { $in: ["Eletrônicos", "Acessórios"] } })</code></td>
</tr>
<tr>
<td style="text-align: left;"><code>$nin</code></td>
<td style="text-align: left;">Não corresponde a nenhum valor do array especificado</td>
<td style="text-align: left;"><code>db.produtos.find({ categoria: { $nin: ["Vestuário", "Alimentos"] } })</code></td>
</tr>
<tr>
<td style="text-align: left;"><code>$exists</code></td>
<td style="text-align: left;">Corresponde a documentos que possuem o campo especificado</td>
<td style="text-align: left;"><code>db.produtos.find({ desconto: { $exists: true } })</code></td>
</tr>
<tr>
<td style="text-align: left;"><code>$type</code></td>
<td style="text-align: left;">Corresponde a documentos com o tipo BSON especificado</td>
<td style="text-align: left;"><code>db.produtos.find({ preco: { $type: "double" } })</code></td>
</tr>
<tr>
<td style="text-align: left;"><code>$regex</code></td>
<td style="text-align: left;">Permite usar expressões regulares para buscar</td>
<td style="text-align: left;"><code>db.produtos.find({ nome: { $regex: /^Smart/i } })</code></td>
</tr>
<tr>
<td style="text-align: left;"><code>$text</code></td>
<td style="text-align: left;">Realiza busca de texto em campos indexados para texto</td>
<td style="text-align: left;"><code>db.produtos.find({ $text: { $search: "smartphone android" } })</code></td>
</tr>
<tr>
<td style="text-align: left;"><code>$all</code></td>
<td style="text-align: left;">Corresponde a arrays que contêm todos os elementos especificados</td>
<td style="text-align: left;"><code>db.produtos.find({ tags: { $all: ["bluetooth", "audio"] } })</code></td>
</tr>
<tr>
<td style="text-align: left;"><code>$elemMatch</code></td>
<td style="text-align: left;">Corresponde a documentos que contêm um array com pelo menos um elemento que satisfaz todos os critérios</td>
<td style="text-align: left;"><code>db.pedidos.find({ itens: { $elemMatch: { quantidade: { $gt: 1 } } } })</code></td>
</tr>
<tr>
<td style="text-align: left;"><code>$size</code></td>
<td style="text-align: left;">Corresponde a arrays com o tamanho especificado</td>
<td style="text-align: left;"><code>db.produtos.find({ tags: { $size: 4 } })</code></td>
</tr>
</tbody>
</table>
<h3 id="exemplos-de-buscas-avancadas">Exemplos de Buscas Avançadas</h3>
<p><strong>Busca exata por valor</strong></p>
<pre><code class="language-javascript">// Busca produtos com preço exatamente 299.99
db.produtos.find({ preco: 299.99 })
</code></pre>
<p><strong>Busca por intervalo de valores</strong></p>
<pre><code class="language-javascript">// Produtos com preço entre 500 e 3000
db.produtos.find({
  preco: { $gte: 500, $lte: 3000 }
})
</code></pre>
<p><strong>Busca com múltiplos critérios (AND implícito)</strong></p>
<pre><code class="language-javascript">// Produtos da categoria Eletrônicos com estoque &gt; 15
db.produtos.find({
  categoria: &quot;Eletrônicos&quot;,
  estoque: { $gt: 15 }
})
</code></pre>
<p><strong>Operador OR</strong></p>
<pre><code class="language-javascript">// Produtos que são Eletrônicos OU custam menos de 500
db.produtos.find({
  $or: [
    { categoria: &quot;Eletrônicos&quot; },
    { preco: { $lt: 500 } }
  ]
})
</code></pre>
<p><strong>Busca por texto (com e sem acentuação)</strong></p>
<pre><code class="language-javascript">// Primeiro, criar um índice de texto
db.produtos.createIndex({ nome: &quot;text&quot;, descricao: &quot;text&quot; })

// Busca por texto ignorando acentuação
db.produtos.find({
  $text: {
    $search: &quot;camera&quot;,
    $caseSensitive: false,
    $diacriticSensitive: false
  }
})
</code></pre>
<p><strong>Busca em campos aninhados</strong></p>
<pre><code class="language-javascript">// Busca produtos com memória de 16GB
db.produtos.find({
  &quot;especificacoes.memoria&quot;: &quot;16GB&quot;
})
</code></pre>
<p><strong>Busca em arrays</strong></p>
<pre><code class="language-javascript">// Produtos com tag &quot;bluetooth&quot;
db.produtos.find({
  tags: &quot;bluetooth&quot;
})

// Produtos com TODAS as tags listadas
db.produtos.find({
  tags: { $all: [&quot;bluetooth&quot;, &quot;audio&quot;] }
})
</code></pre>
<p><strong>Busca por expressão regular</strong></p>
<pre><code class="language-javascript">// Produtos que começam com &quot;Smart&quot;
db.produtos.find({
  nome: { $regex: /^Smart/i }
})

// Produtos com nome contendo &quot;Pro&quot; em qualquer posição
db.produtos.find({
  nome: { $regex: /Pro/i }
})
</code></pre>
<p><strong>Projeção de campos</strong></p>
<pre><code class="language-javascript">// Retornar apenas nome e preço
db.produtos.find(
  { categoria: &quot;Eletrônicos&quot; },
  { nome: 1, preco: 1 }
)

// Excluir campos específicos
db.produtos.find(
  { categoria: &quot;Eletrônicos&quot; },
  { especificacoes: 0, tags: 0 }
)
</code></pre>
<hr />
<h2 id="modulo-5-indices-e-performance">Módulo 5: Índices e Performance</h2>
<h3 id="criacao-de-indices">Criação de Índices</h3>
<pre><code class="language-javascript">// Índice simples
db.produtos.createIndex({ nome: 1 })  // 1 ascendente, -1 descendente

// Índice composto
db.produtos.createIndex({ categoria: 1, preco: -1 })

// Índice único
db.clientes.createIndex({ email: 1 }, { unique: true })

// Índice de texto
db.produtos.createIndex({
  nome: &quot;text&quot;,
  descricao: &quot;text&quot;
})

// Índice esparso (só para documentos que têm o campo)
db.produtos.createIndex(
  { promocao: 1 },
  { sparse: true }
)

// Índice TTL (expiração após período)
db.sessoes.createIndex(
  { ultimoAcesso: 1 },
  { expireAfterSeconds: 3600 }
)

// Índice geoespacial
db.lojas.createIndex({ localizacao: &quot;2dsphere&quot; })
</code></pre>
<h3 id="gerenciamento-de-indices">Gerenciamento de Índices</h3>
<pre><code class="language-javascript">// Listar índices
db.produtos.getIndexes()

// Remover um índice
db.produtos.dropIndex(&quot;nome_1&quot;)

// Remover todos os índices (exceto _id)
db.produtos.dropIndexes()
</code></pre>
<h3 id="analise-de-consultas">Análise de Consultas</h3>
<pre><code class="language-javascript">// Explicação da consulta
db.produtos.find({ categoria: &quot;Eletrônicos&quot; }).explain()

// Explicação detalhada
db.produtos.find({ categoria: &quot;Eletrônicos&quot; }).explain(&quot;executionStats&quot;)

// Verificar uso de índices
db.produtos.find({
  categoria: &quot;Eletrônicos&quot;,
  preco: { $gt: 1000 }
}).hint({ categoria: 1, preco: -1 }).explain()
</code></pre>
<hr />
<h2 id="modulo-6-modelagem-de-dados-em-mongodb">Módulo 6: Modelagem de Dados em MongoDB</h2>
<h3 id="abordagens-de-modelagem">Abordagens de Modelagem</h3>
<ol>
<li><strong>Documentos Aninhados (Embedding)</strong><ul>
<li>Melhor para relações 1:1 e 1:poucos</li>
<li>Acesso em uma única operação</li>
<li>Limitado pelo tamanho máximo do documento (16MB)</li>
</ul>
</li>
<li><strong>Referências (Linking)</strong><ul>
<li>Melhor para relações 1:muitos e muitos:muitos</li>
<li>Evita duplicação de dados</li>
<li>Requer múltiplas operações para acessar dados relacionados</li>
</ul>
</li>
</ol>
<h3 id="exemplos-de-modelagem">Exemplos de Modelagem</h3>
<p><strong>Modelo com documentos aninhados (Embedding)</strong></p>
<pre><code class="language-javascript">// Cliente com endereços aninhados
db.clientes.insertOne({
  nome: &quot;Carlos Mendes&quot;,
  email: &quot;carlos@email.com&quot;,
  telefone: &quot;(47) 98765-4321&quot;,
  enderecos: [
    {
      tipo: &quot;residencial&quot;,
      rua: &quot;Rua das Palmeiras&quot;,
      numero: &quot;123&quot;,
      cidade: &quot;Florianópolis&quot;,
      estado: &quot;SC&quot;
    },
    {
      tipo: &quot;trabalho&quot;,
      rua: &quot;Av. Beira Mar&quot;,
      numero: &quot;1500&quot;,
      cidade: &quot;Florianópolis&quot;,
      estado: &quot;SC&quot;
    }
  ]
})
</code></pre>
<p><strong>Modelo com referências (Linking)</strong></p>
<pre><code class="language-javascript">// Cliente referenciando pedidos
db.clientes.insertOne({
  nome: &quot;Carlos Mendes&quot;,
  email: &quot;carlos@email.com&quot;,
  pedidos: [
    ObjectId(&quot;7a8b9c0d1e2f3g4h5i6j1112&quot;),
    ObjectId(&quot;7a8b9c0d1e2f3g4h5i6j1113&quot;)
  ]
})

// Pedidos com referência ao cliente
db.pedidos.insertOne({
  _id: ObjectId(&quot;7a8b9c0d1e2f3g4h5i6j1112&quot;),
  clienteId: ObjectId(&quot;6a1b2c3d4e5f6a7b8c9d4444&quot;),
  data: ISODate(&quot;2023-11-15T10:30:00Z&quot;),
  total: 599.98,
  produtos: [
    { id: ObjectId(&quot;5f8d0d55b54764429c1e3333&quot;), qtd: 2 }
  ]
})
</code></pre>
<h3 id="consultas-em-dados-relacionados">Consultas em Dados Relacionados</h3>
<pre><code class="language-javascript">// Consulta em dados aninhados
db.clientes.find({
  &quot;enderecos.cidade&quot;: &quot;Florianópolis&quot;
})

// Consulta juntando cliente e pedido (manual)
const cliente = db.clientes.findOne({
  email: &quot;carlos@email.com&quot;
})

const pedidosCliente = db.pedidos.find({
  clienteId: cliente._id
}).toArray()

// Agregação para juntar dados
db.pedidos.aggregate([
  {
    $match: {
      clienteId: ObjectId(&quot;6a1b2c3d4e5f6a7b8c9d4444&quot;)
    }
  },
  {
    $lookup: {
      from: &quot;clientes&quot;,
      localField: &quot;clienteId&quot;,
      foreignField: &quot;_id&quot;,
      as: &quot;cliente&quot;
    }
  }
])
</code></pre>
<hr />
<h2 id="modulo-7-agregacoes">Módulo 7: Agregações</h2>
<h3 id="estagios-de-agregacao-comuns">Estágios de Agregação Comuns</h3>
<pre><code class="language-javascript">// $match - Filtra documentos
db.produtos.aggregate([
  { $match: { preco: { $gt: 1000 } } }
])

// $group - Agrupa documentos
db.produtos.aggregate([
  { $group: {
      _id: &quot;$categoria&quot;,
      count: { $sum: 1 },
      mediaPreco: { $avg: &quot;$preco&quot; },
      minPreco: { $min: &quot;$preco&quot; },
      maxPreco: { $max: &quot;$preco&quot; }
  }}
])

// $project - Seleciona campos específicos
db.produtos.aggregate([
  { $match: { categoria: &quot;Eletrônicos&quot; } },
  { $project: {
      nome: 1,
      preco: 1,
      valorComImposto: { $multiply: [&quot;$preco&quot;, 1.15] }
  }}
])

// $sort - Ordena documentos
db.produtos.aggregate([
  { $sort: { preco: -1 } }  // ordem descendente
])

// $limit - Limita número de resultados
db.produtos.aggregate([
  { $sort: { preco: -1 } },
  { $limit: 5 }
])

// $unwind - &quot;Explode&quot; um array em múltiplos documentos
db.produtos.aggregate([
  { $unwind: &quot;$tags&quot; },
  { $group: {
      _id: &quot;$tags&quot;,
      count: { $sum: 1 }
  }}
])

// $lookup - Join entre coleções
db.pedidos.aggregate([
  { $match: { status: &quot;Entregue&quot; } },
  { $lookup: {
      from: &quot;clientes&quot;,
      localField: &quot;clienteId&quot;,
      foreignField: &quot;_id&quot;,
      as: &quot;cliente&quot;
  }},
  { $unwind: &quot;$cliente&quot; }
])
</code></pre>
<h3 id="exemplo-de-relatorio-completo">Exemplo de Relatório Completo</h3>
<pre><code class="language-javascript">// Relatório de vendas por categoria
db.pedidos.aggregate([
  // Apenas pedidos concluídos
  { $match: { status: { $in: [&quot;Entregue&quot;, &quot;Em Transporte&quot;] } } },
  // Desdobrar itens de cada pedido
  { $unwind: &quot;$itens&quot; },
  // Juntar com produtos para obter categoria
  { $lookup: {
      from: &quot;produtos&quot;,
      localField: &quot;itens.produtoId&quot;,
      foreignField: &quot;_id&quot;,
      as: &quot;produto&quot;
  }},
  { $unwind: &quot;$produto&quot; },
  // Calcular valor total por item
  { $project: {
      categoria: &quot;$produto.categoria&quot;,
      valorItem: { $multiply: [&quot;$itens.quantidade&quot;, &quot;$itens.precoUnitario&quot;] },
      data: &quot;$dataPedido&quot;
  }},
  // Agrupar por categoria
  { $group: {
      _id: &quot;$categoria&quot;,
      totalVendas: { $sum: &quot;$valorItem&quot; },
      quantidadePedidos: { $sum: 1 }
  }},
  // Ordenar do maior para o menor valor
  { $sort: { totalVendas: -1 } }
])
</code></pre>
<hr />
<h2 id="modulo-8-operacoes-avancadas">Módulo 8: Operações Avançadas</h2>
<h3 id="exportacao-para-csv">Exportação para CSV</h3>
<pre><code class="language-bash"># No terminal (não no shell MongoDB)!
mongoexport --db=ecommerce --collection=produtos --type=csv --fields=nome,categoria,preco,estoque --out=produtos.csv

# Com autenticação
mongoexport --db=ecommerce --collection=produtos --type=csv --fields=nome,categoria,preco,estoque --out=produtos.csv --username usuario --password senha --authenticationDatabase admin
</code></pre>
<h3 id="geracao-de-pdf-com-mongodb-e-nodejs">Geração de PDF com MongoDB e Node.js</h3>
<pre><code class="language-javascript">// Usando Node.js com MongoDB e PDFKit
const { MongoClient } = require('mongodb');
const PDFDocument = require('pdfkit');
const fs = require('fs');

async function gerarRelatorioPDF() {
  const client = await MongoClient.connect('mongodb://localhost:27017');
  const db = client.db('ecommerce');

  // Obter dados para o relatório
  const produtos = await db.collection('produtos')
    .find({ categoria: &quot;Eletrônicos&quot; })
    .sort({ preco: -1 })
    .toArray();

  // Criar PDF
  const doc = new PDFDocument();
  doc.pipe(fs.createWriteStream('relatorio_produtos.pdf'));

  // Adicionar título
  doc.fontSize(20).text('Relatório de Produtos Eletrônicos', {
    align: 'center'
  });

  // Adicionar dados ao PDF
  doc.moveDown();
  produtos.forEach(produto =&gt; {
    doc.fontSize(14).text(produto.nome);
    doc.fontSize(12).text(`Preço: R$ ${produto.preco.toFixed(2)}`);
    doc.fontSize(12).text(`Estoque: ${produto.estoque} unidades`);
    doc.moveDown();
  });

  doc.end();
  client.close();
}

gerarRelatorioPDF();
</code></pre>
<h3 id="backup-e-restauracao">Backup e Restauração</h3>
<pre><code class="language-bash"># Backup de um banco de dados
mongodump --db=ecommerce --out=/caminho/backup/

# Backup de uma coleção específica
mongodump --db=ecommerce --collection=produtos --out=/caminho/backup/

# Backup com compressão
mongodump --db=ecommerce --out=/caminho/backup/ --gzip

# Restauração de um banco de dados
mongorestore --db=ecommerce /caminho/backup/ecommerce/

# Restauração de uma coleção específica
mongorestore --db=ecommerce --collection=produtos /caminho/backup/ecommerce/produtos.bson
</code></pre>
<h3 id="movendo-dados-entre-bancos">Movendo Dados Entre Bancos</h3>
<pre><code class="language-javascript">// Via MongoDB Shell
// Copiar dados de uma coleção para outra
db.produtos.find().forEach(function(doc) {
  db.getSiblingDB('ecommerce_backup').produtos.insert(doc);
});

// Via mongoexport/mongoimport
// No terminal
mongoexport --db=ecommerce --collection=produtos --out=produtos.json
mongoimport --db=ecommerce_novo --collection=produtos --file=produtos.json
</code></pre>
<h3 id="gerenciamento-de-erros-comuns">Gerenciamento de Erros Comuns</h3>
<ol>
<li>
<p><strong>Conexão Recusada</strong></p>
<p><code>MongoConnectionError: connect ECONNREFUSED 127.0.0.1:27017</code></p>
<p>```bash</p>
<h1 id="solucao-verificar-se-o-servico-mongodb-esta-rodando">Solução - verificar se o serviço MongoDB está rodando</h1>
<p>sudo systemctl status mongod</p>
<h1 id="ou-no-docker">ou no Docker</h1>
<p>docker ps | grep mongo
```</p>
</li>
<li>
<p><strong>Violação de Índice Único</strong></p>
<p><code>// Erro ao inserir documento com valor duplicado em campo com índice único</code></p>
<p><code>javascript
// Solução - usar upsert
db.clientes.updateOne(
  { email: "maria.silva@email.com" },
  { $set: { nome: "Maria Silva", telefone: "11987654321" } },
  { upsert: true }
)</code></p>
</li>
<li>
<p><strong>Consulta com ID Inválido</strong></p>
<p><code>// Erro
// Uncaught exception: Error: invalid object id: length</code></p>
<p><code>javascript
// Solução - verificar o formato do ObjectId
if (ObjectId.isValid(idString)) {
  db.produtos.findOne({ _id: ObjectId(idString) });
} else {
  // lidar com ID inválido
}</code></p>
</li>
</ol>
<hr />
<h2 id="modulo-9-mongodb-em-ambientes-reais">Módulo 9: MongoDB em Ambientes Reais</h2>
<h3 id="mongodb-com-docker-compose">MongoDB com Docker Compose</h3>
<ul>
<li>docker-compose.yml</li>
</ul>
<pre><code class="language-yaml">version: '3'
services:
  mongodb:
    image: mongo:latest
    container_name: mongodb
    ports:
      - &quot;27017:27017&quot;
    environment:
      MONGO_INITDB_ROOT_USERNAME: admin
      MONGO_INITDB_ROOT_PASSWORD: senha123
    volumes:
      - mongo_data:/data/db
    networks:
      - mongo_network
  mongo-express:
    image: mongo-express:latest
    container_name: mongo-express
    depends_on:
      - mongodb
    ports:
      - &quot;8081:8081&quot;
    environment:
      ME_CONFIG_MONGODB_ADMINUSERNAME: admin
      ME_CONFIG_MONGODB_ADMINPASSWORD: senha123
      ME_CONFIG_MONGODB_SERVER: mongodb
      ME_CONFIG_BASICAUTH_USERNAME: admin
      ME_CONFIG_BASICAUTH_PASSWORD: senha123
    networks:
      - mongo_network
volumes:
  mongo_data:
networks:
  mongo_network:
    driver: bridge
</code></pre>
<h3 id="mongodb-com-replicacao">MongoDB com Replicação</h3>
<ul>
<li>Iniciar um conjunto de réplicas com Docker</li>
</ul>
<pre><code class="language-bash">docker run -d --name mongo1 -p 27017:27017 mongo --replSet rs0
docker run -d --name mongo2 -p 27018:27017 mongo --replSet rs0
docker run -d --name mongo3 -p 27019:27017 mongo --replSet rs0
</code></pre>
<ul>
<li>Configurar o conjunto de réplicas</li>
</ul>
<pre><code class="language-bash">docker exec -it mongo1 mongosh --eval &quot;rs.initiate({
  _id: 'rs0',
  members: [
    { _id: 0, host: 'localhost:27017' },
    { _id: 1, host: 'localhost:27018' },
    { _id: 2, host: 'localhost:27019' }
  ]
})&quot;
</code></pre>
<h3 id="mongodb-atlas-servico-na-nuvem">MongoDB Atlas (Serviço na Nuvem)</h3>
<pre><code class="language-javascript">// Conexão com MongoDB Atlas
const { MongoClient } = require('mongodb');
const uri = &quot;mongodb+srv://usuario:senha@cluster0.mongodb.net/ecommerce?retryWrites=true&amp;w=majority&quot;;
const client = new MongoClient(uri);

async function conectar() {
  try {
    await client.connect();
    console.log(&quot;Conectado ao MongoDB Atlas!&quot;);
    const db = client.db('ecommerce');
    const produtos = await db.collection('produtos').find().limit(5).toArray();
    console.log(produtos);
  } finally {
    await client.close();
  }
}

conectar().catch(console.error);
</code></pre>
<h3 id="seguranca-e-autenticacao">Segurança e Autenticação</h3>
<pre><code class="language-javascript">// Criar usuário com permissões específicas
db.createUser({
  user: &quot;app_user&quot;,
  pwd: &quot;senha_segura&quot;,
  roles: [
    { role: &quot;readWrite&quot;, db: &quot;ecommerce&quot; },
    { role: &quot;read&quot;, db: &quot;analytics&quot; }
  ]
})

// Iniciar MongoDB com autenticação
// mongod --auth

// Conectar com autenticação
mongo -u app_user -p senha_segura --authenticationDatabase admin
</code></pre></p>
    </article>
</section>
            <!-- endblock -->

            <!-- block footer -->
                <footer>
    <div class="d-flex flex-sm-row justify-content-between py-2 border-top drac-text-black drac-bg-cyan-green">
        <a href="https://github.com/dracula/mkdocs" target="_blank" style="padding-left: 1%;"
            class="footer-text drac-anchor drac-text-black drac-text-purple--hover">
            Made with Dracula Theme for MkDocs
        </a>
    </div>
</footer>
            <!-- endblock -->
        </div>

    </main>

        <script>var base_url = '../..';</script>
        <script src="../../assets/js/jquery-3.3.1.slim.min.js"></script>
        <script src="../../assets/js/bootstrap.bundle.min.js"></script>
        <script src="../../assets/js/mkdocs.js"></script>
			<script src="../../search/main.js" defer></script>

</body>

</html>